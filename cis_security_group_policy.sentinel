import "tfplan"

# Define allowed ingress ports
allowed_ingress_ports = [80, 443, 22]

# Enforce CIS security group policy
main = rule {
  all tfplan.resources.aws_security_group as _, sg {
    all sg.ingress as _, rule {
      allowed_ingress_ports contains rule.from_port
    }
    all sg.egress as _, rule {
      rule.from_port == 0 and rule.to_port == 0 and rule.protocol == "-1" and rule.cidr_blocks == ["0.0.0.0/0"]
    }
  }
}
